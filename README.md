# nx-script

A simple scripting language, written in C# with ANTLR4.

![image](https://github.com/user-attachments/assets/ee244615-9a5e-4d42-a6df-69844b8b309d)

---

This project was built to showcase how easy it can be to build your own scripting language with ANTLR4.
It includes a basic language with support for variables and control structures, as well as a more advanced version with functions,
basic I/O, objects (That support reference types as keys) and more.

Both implementations are visitor-based. They operate directly on the `ParseTree` generated by ANTLR4. To see what each language can do,
check out the sample scripts in the respective directories, aswell as the grammar files.

## Prerequisites

- .NET 8.0
- Java JDK 17 or 21
- ANTLR 4.13.1 [See Setup Guide](#antlr4-toolchain---windows-11-setup-quickguide)

> [!NOTE]
> You do not **need** to install the JDK and ANTLR4 if you only want to run the sample scripts. The parser binaries generated by ANTLR4 are included in the repository.
> You only need the JDK and ANTLR4 if you want to modify the grammar and regenerate the parser.

## Quickstart

The easiest way to get started is to use Visual Studio 2022. Open the solution file and run the project.
There are launch configurations for both the _nx-script_ and _nx-script-basic_ projects - just select the one you want to run.

### Cli

Change into either the _nx-script_ or _nx-script-basic_ directory.

Build the project.

```shell
dotnet build
```

Run the sample script.

> nx-script-basic

```shell
.\bin\Debug\net8.0\nxsb .\SampleScript.nxb
```

> nx-script

```shell
.\bin\Debug\net8.0\nxs .\SampleScript.nx
```

### Syntax-Highlighting for `nx-script`

The more advanced version (_nx-script_) of the language also has a TextMate grammar for syntax highlighting in Visual Studio Code.
To use it for the first time,

1. Copy the `syntax` directory to your `.vscode/extensions` directory, commonly located at `%USERPROFILE%\.vscode\extensions`.
2. Rename the `syntax` directory to `NxScriptTextMate`

> [!TIP]
> After initially copying the `NxScriptTextMate` directory, you can update the grammar by simply running the provided `copy-vscode-syntax.bat` script.
> This will copy the latest version of the grammar to the correct directory.

---

# ANTLR4 Toolchain - Windows 11 Setup Quickguide

## Install JDK

1. Download & Install JDK (Java Devkit) Version 17 or 21
   https://www.oracle.com/java/technologies/downloads/

2. Open your **system** environment variables. Open the `Path` variable and add a link to the JDK _bin_ directory. (Usually `C:/Program Files/Java/jdk/bin`)

> If you already have a Java installation, move the new Entry in `Path` up, so that it's higher priority.

## Install ANTLR4

1. Download the ANTLR4 jar. Currently Version 4.13.1 (Nov 2023) from
   https://www.antlr.org/download.html (klick on the **"ANTLR tool itself"** link)

2. Move the downloaded jar to `C:/Program Files/Java/libs` (make a new directory if it does not exist)

3. In the **system** environment variables, add a new variable called `CLASSPATH`. Set the Value to `C:/Program Files/Java/libs/antlr-4.13.1-complete.jar`

## Setup ANTLR Env Batch Files

We'll create two convenience batch files which help interacting with ANTLR4. We'll add these commands to the system path:

- `grun`, which will help you test your grammars with the ANTLR4 built-in test rig.
- `antlr4`, which offers a shortcut to the ANTLR4 tool cli.

1. In `C:/Program Files/Java/libs/` create a directory called "batches". Make two new batches: `antlr4.bat` & `grun.bat`
   (You probably have to create the files somwhere else because of the directory protection).

### `grun.bat`

```batch
@echo off
set TEST_CURRENT_DIR=%CLASSPATH:.;=%
if "%TEST_CURRENT_DIR%" == "%CLASSPATH%" ( set CLASSPATH=.;%CLASSPATH% )
@echo on
java org.antlr.v4.gui.TestRig %*
```

### `antlr4.bat`

```batch
java org.antlr.v4.Tool %*
```

3. Open your **user** environment variables. Open the `Path` variable, and add a link to the _batches_ directory. E.g. `C:/Program Files/Java/libs/batches`

4. Test by opening a terminal and call `antlr4` and `grun`

## `grun` Commands

Here's a quick reference for the `grun` command.
Example grammar name: _MyGrammar_, Example Starting Rule: _program_

- Basic call: `grun MyGrammar program`
- List tokens: `grun MyGrammar program -tokens`
- CLI tree: `grun MyGrammar program -tree`
- GUI tree: `grun MyGrammar program -gui`
- Load from File: `grun MyGrammar program testCode.mygrammar`
